---
title: React å¼‚æ­¥æ¸²æŸ“å†…å®¹
authors: [visualdust]
tags: [frontend, react]
---

åœ¨React(typescript)ä¸­æ¸²æŸ“éœ€å³æ—¶åŠ è½½çš„å…ƒç´ ã€‚ä¸»è¦æ€è·¯æ˜¯ä½¿ç”¨useEffect HookåŠ è½½å†…å®¹ï¼Œè€Œåä½¿ç”¨useState Hookåœ¨åŠ è½½å®Œæˆæ—¶é‡æ–°æ¸²æŸ“ç•Œé¢ã€‚ç®€çŸ­çš„ä»£ç æè¿°å¦‚ä¸‹ï¼š

```tsx
interface AsyncCompomentProps {
  func: () => Promise<JSX.Element>;
  default?: JSX.Element;
}

function AsyncComponent(props: AsyncCompomentProps) {
  const [loaded, setLoaded] = useState<JSX.Element>(null);
  useEffect(() => {
    props.func().then((result) => {
      setLoaded(result);
    });
  }, []);
  return loaded ? loaded : props.default ?? <div>Loading...</div>;
}

<AsyncComponent
  func={async () => {
    await new Promise((r) => setTimeout(r, 3000));
    return <div>hi</div>;
  }}
  default={<div>I'm loading...</div>}
/>;
```

<!--truncate-->

åœ¨reactä¸­ï¼Œè¿™ç§åŒ…å«äº†data fetchingçš„æ“ä½œç»å¸¸å‡ºç°ã€‚React æ²¡æœ‰å†…ç½®çš„ä»ç»„ä»¶ä¸­è·å–æˆ–æ›´æ–°æ•°æ®çš„æ–¹å¼ï¼Œå› æ­¤å¼€å‘äººå‘˜æœ€ç»ˆä¼šæ„å»ºè‡ªå·±çš„è·å–æ•°æ®çš„æ–¹å¼ã€‚ è¿™é€šå¸¸æ„å‘³ç€ä½¿ç”¨ React Hooks å°†åŸºäºç»„ä»¶çš„çŠ¶æ€ state å’Œ effects æ•´åˆåœ¨ä¸€èµ·ï¼Œæˆ–è€…ä½¿ç”¨æ›´é€šç”¨çš„çŠ¶æ€ç®¡ç†åº“æ¥å­˜å‚¨å’Œæä¾›æ•´ä¸ªç¨‹åºä¸­çš„å¼‚æ­¥æ•°æ®ã€‚ä¸ºäº†ç®€åŒ–è¿™ç§æ“ä½œï¼ŒReact Queryåº”è¿è€Œç”Ÿã€‚React Queryæ˜¯ä¸€ç»„React Hookï¼Œå®ƒæ˜“äºä½¿ç”¨ï¼Œå…¶æœ€åŸºæœ¬çš„Hookæ˜¯`useQuery`ï¼Œä¾‹å¦‚ï¼š

```typescript
function Example() {
  const { isLoading, error, data, isFetching } = useQuery("repoData", () =>
    fetch(
      "https://api.github.com/repos/tannerlinsley/react-query"
    ).then((res) => res.json())
  );
  if (isLoading) return "Loading...";
  if (error) return "An error has occurred: " + error.message;
  return (
    <div>
      <h1>{data.name}</h1>
      <p>{data.description}</p>
      <strong>ğŸ‘€ {data.subscribers_count}</strong>{" "}
      <strong>âœ¨ {data.stargazers_count}</strong>{" "}
      <strong>ğŸ´ {data.forks_count}</strong>
      <div>{isFetching ? "Updating..." : ""}</div>
      <ReactQueryDevtools initialIsOpen />
    </div>
  );
}
```

åé¢ä¼šä¸“é—¨å¼€ä¸€é¡µReactQueryç›¸å…³çš„å†…å®¹ã€‚